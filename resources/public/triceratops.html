<html>
<head>
<title>TRICERATOPS</title>
<script src="js/jquery.js"></script>
<script src="js/codemirror/lib/codemirror.js"></script>
<link rel="stylesheet" href="js/codemirror/lib/codemirror.css">
<script src="js/codemirror/mode/javascript/javascript.js"></script>
<link rel="stylesheet" href="js/codemirror/theme/default.css">
<script src="js/Three.js"></script>
<script src="js/triceratops.js"></script>

<style type="text/css">
  .CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}
  .activeline {background: #f0fcff !important;}
</style>
</head> 
 
<body onload="init()" onunload="closeWebSocket()">
 
<div id="pre">
  <label>what is your name?</label>
  <input type="text" value="" id="name">
</div>

<form>
  <textarea id="code" name="code">
    var socket;
    var name;

    function openWebSocket() {
      if (window.WebSocket) {   
        socket = new WebSocket('ws://triceratops.me:11122');
        socket.onopen    = function(event) { $('#alert').html('channel open!'); };
        socket.onclose   = function(event) { $('#alert').html('channel closed'); };
        socket.onmessage = function(event) { parse(event.data); };
      } else {
        alert('Your browser does not support WebSockets yet.');
      }
    }

    function init() {
      openWebSocket();

      $('#chat').hide();
      $('#name').keypress(function(e) {
                            if (e.which === 13) {
                              sendName();
                            }
                          });

      $('#voice').keypress(function(e) {
                             if (e.which === 13) {
                               sendVoice();
                             }
                           });
    }

    function closeWebSocket() {
      socket.close();
    }

    function send(message) {
      if (!window.WebSocket) { return; }
      if (socket.readyState == (WebSocket.OPEN || 1)) {
        socket.send(message);
      } else {
        alert('The WebSocket is not open!');
      }
    }

    function parse( response ) {
      $('#out').append(response+"<br/>");
    }

    function sendName() {
      name = $('#name').val();
      send(name); 
      $('title').html(name);
      $('#pre').hide();
      $('#chat').show();
    }

    function sendVoice() {
      send($('#voice').val()); 
      $('#voice').val('');
    }
  </textarea>
</form>

<div id="out"></div>

<script>
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
mode: "javascript",
lineNumbers: true,
onCursorActivity: function() {
editor.setLineClass(hlLine, null);
hlLine = editor.setLineClass(editor.getCursor().line, "activeline");
}
});
var hlLine = editor.setLineClass(0, "activeline");
</script>

</body>
</html>
